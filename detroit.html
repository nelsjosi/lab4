<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Mapbox Map</title>
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">

    <!-- Leaflet JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <style>
        #map { height: 400px; }
        .info { padding: 6px 8px; font: 14px/16px Arial, Helvetica, sans-serif; background: white; background: rgba(255,255,255,0.8); box-shadow: 0 0 15px rgba(0,0,0,0.2); border-radius: 5px; }
        .info h4 { margin: 0 0 5px; color: #777; }
    </style>
</head>
<body>

    <h1 style="font-size: 16px; font-weight: bold;">Health Insurance in Detroit</h1>

    <!-- Map container -->
    <div id="map"></div>

    <!-- Leaflet Map Setup Script -->
    <script>
        // Initialize the map
        var map = L.map('map').setView([42.536, -83.188], 7.98);

        // Add your Mapbox style as the base layer
        L.tileLayer('https://api.mapbox.com/styles/v1/nelsjosi/clowf0ch9008w01r6d3s90iix/tiles/256/{z}/{x}/{y}?access_token=pk.eyJ1IjoibmVsc2pvc2kiLCJhIjoiY2xvdXJpcTlyMGlnbDJqbzZnYzBpaDJwdyJ9.TFehieFMapa9HP0UJgkETg', {
            tileSize: 512,
            zoomOffset: -1,
            maxZoom: 19,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        // Define GeoJSON layer
        var geojson;

        // Fetch GeoJSON data
        fetch('HealthInsuranceCoverage.geojson')
          .then(response => {
            if (!response.ok) {
              throw new Error(`Network response was not ok: ${response.statusText}`);
            }
            return response.json();
          })
          .then(geojsonData => {
            // Add GeoJSON layer to the map with custom styling and listeners
            geojson = L.geoJSON(geojsonData, {
                style: function(feature) {
                    return {
                        fillColor: getColor(feature.properties.NoHealthInsurance),
                        weight: 2,
                        opacity: 1,
                        color: 'white',
                        dashArray: '3',
                        fillOpacity: 0.7
                    };
                },
                onEachFeature: onEachFeature
            }).addTo(map);
          })
          .catch(error => {
            console.error('There was a problem with the fetch operation:', error);
          });

        // Function to get color based on the NoHealthInsurance property
        function getColor(d) {
    return d > 1000 ? '#045a8d' :
        d > 500  ? '#2b8cbe' :
        d > 200  ? '#4eb3d3' :
        d > 100  ? '#7bccc4' :
        d > 50   ? '#a8ddb5' :
        d > 20   ? '#ccebc5' :
        d > 10   ? '#e0f3db' :
                    '#f7fcf0';
}

        // Function to highlight feature on mouseover
        function highlightFeature(e) {
            var layer = e.target;

            layer.setStyle({
                weight: 5,
                color: '#666',
                dashArray: '',
                fillOpacity: 0.7
            });

            layer.bringToFront();
            info.update(layer.feature.properties);
        }

        // Function to reset highlight on mouseout
        function resetHighlight(e) {
            geojson.resetStyle(e.target);
            info.update();
        }

        // Function to zoom to feature on click
        function zoomToFeature(e) {
            map.fitBounds(e.target.getBounds());
        }

        // Function to add listeners to each feature
        function onEachFeature(feature, layer) {
            layer.on({
                mouseover: highlightFeature,
                mouseout: resetHighlight,
                click: zoomToFeature
            });
        }

        // Custom Info Control
        var info = L.control();

        info.onAdd = function (map) {
            this._div = L.DomUtil.create('div', 'info'); // create a div with a class "info"
            this.update();
            return this._div;
        };

        // method that we will use to update the control based on feature properties passed
        info.update = function (props) {
            this._div.innerHTML = '<h4>Number of People Without Health Insurance</h4>' +  (props ?
                '<b>' + '</b><br />' + props.NoHealthInsurance 
                : 'Hover over a block');
        };

        info.addTo(map);

        
    </script>

</body>
</html>
